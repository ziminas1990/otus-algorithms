
# Homework #18: Поиск паттерна в тексте
## О приложении
Приложение реализует алгоритм Бойера-Мура-Хорспула (далее "БМХ"), а так же алгоритм Кнута-Морисса-Прата (далее "КМП").  
Приложение имеет 3 режима работы, которые передаются ему первым параметром:
  - **autotests** - прогон автотестов для обоих алгоримтов;
  - **trace** - режим трассировки для алгоритма БМХ;
  - **perfomance** - измерение производительности.

### Режим автотестов
Здесь всё просто: формируется случайный текст на 100.000 символов и случайный шаблон (случаынй фрагмент текста длиной от 3 до 12 символов). Производится поиск с помощью наивного алгоритма и его результат считается эталонным. Затем производится поиск с помощью тестируемого алгоритма (БМХ или КМП) и результаты сравниваются с эталонными. Если результаты равны, то тест считается пройденным.
Каждый тест прогоняется 500 раз для каждого из тестируемых алгоритмов.

Пример вывода:
```
Testing Boyer-Moore-Horspool: OK (2940 ms)
Testing Knuth-Morris-Prata: OK (4089 ms)
```
### Режим трассировки
Реализован только для алгоритма БМХ.
Данный режим позволяет посмотреть по шагам, как алгоритм смещает шаблон по тексту. Чтобы запустить приложение в таком режиме, необходимо передать 3 параметра:
```
./KMP trace <pattern> <text>
```

Например:
```
trace GAGADE GAGGASDGAGAGADEDSGAGGAGADEGA > test.txt
```
```
Offset: 0
GAGGASDGAGAGADEDSGAGGAGADEGA
GAGADE
Offset: 5
GAGGASDGAGAGADEDSGAGGAGADEGA
     GAGADE
Offset: 7
GAGGASDGAGAGADEDSGAGGAGADEGA
       GAGADE
Offset: 9
GAGGASDGAGAGADEDSGAGGAGADEGA
         GAGADE
Offset: 10
GAGGASDGAGAGADEDSGAGGAGADEGA
          GAGADE
Offset: 11
GAGGASDGAGAGADEDSGAGGAGADEGA
           GAGADE
Offset: 16
GAGGASDGAGAGADEDSGAGGAGADEGA
                GAGADE
Offset: 18
GAGGASDGAGAGADEDSGAGGAGADEGA
                  GAGADE
Offset: 20
GAGGASDGAGAGADEDSGAGGAGADEGA
                    GAGADE
Offset: 21
GAGGASDGAGAGADEDSGAGGAGADEGA
                     GAGADE
2 matches: 9 20 
```

### Режим измерения производительности
Для запуска приложения в данном режиме необходимо передать 4 параметра:
```
./KMP perfomance <minTextSize> <maxTextSize> <step>
```
, где:
  - minTextSize - начальный размер текста;
  - maxTextSize - конечный размер текста;
  - step - шаг увеличения размера текста.

В данном режиме, приложение:
1. формирует несколько случайных текстов длиной от minTextSize  до maxTextSize  с шагом step
2. на каждом тексте выбирает произвольный шаблон (подстрока в 15 символов);
3. 100 раз запускает наивную реализацию поиска и вычисляет суммарное время её выполнения;
4. 100 раз запускает поиск по БМХ и вычисляет суммарное время работы;
5. 100 раз запускает поиск по КМП и вычисляет суммарное время работы;
6. выводит на экран строчку с количеством символов в тексте и временем из п. 3, п.4 и п.5.

Таким образом, приложение выводит таблицу с временем работы разных алгоритмов на тексте различной длины. По такой таблице можно построить наглядный график используя, например, Excel или Google Spreadsheet.
Например:
```
./KMP perfomance 100000 500000 100000
```
```
100000 187 63 398
200000 374 124 780
300000 551 177 1162
400000 731 238 1542
500000 931 283 1956
```

## Комментарии к коду
В исходный код приложения добавлено достаточно много комментариев, поясняющих работу алгоритмов, однако вместо пояснений устройства **таблицы смещений** для алгоритма БМХ и **таблицы переходов** для алгоритма КМП читатель отсылался к README.md.  
Здесь я и расскажу подробнее об этих таблицах.

**Таблица переходов** для алгоритма БМХ приведена в документе [HW-18-PatternsSearch](https://docs.google.com/spreadsheets/d/1OT7pP8-WPGUHI9k-KMtUJmSO5Ru7rs6dUqFkO2y6P9E/edit?usp=sharing) на второй странице "Боейр-Мурр-Хорспул". Там приведён пример таблицы и под таблицей приведено пояснение к её содержимому.

**Таблица переключений состояний** для алгоритма КМП так же приведена в документе [HW-18-PatternsSearch](https://docs.google.com/spreadsheets/d/1OT7pP8-WPGUHI9k-KMtUJmSO5Ru7rs6dUqFkO2y6P9E/edit?usp=sharing), на странице "Кнутт-Моррис-Прата". На ней приведён пример таблицы и под таблицей приведено пояснение к её содержимому.

## Сравнение производительности
Для сравнения производительности приложение было запущено в режиме **perfomance** со следующими параметрами:
```
./KMP perfomance 25000 15000 500000
```
Таблицу производительности и наглядный график по ним я опубликовал в виде [электронной таблицы](https://docs.google.com/spreadsheets/d/1OT7pP8-WPGUHI9k-KMtUJmSO5Ru7rs6dUqFkO2y6P9E/edit?usp=sharing) (график загружается не сразу, нужно немного подождать).

Данный тест производительности работает только со случайными текстами и шаблонами, таким образом, из-за чего эвристики, заложенные в алгоритмы поиска БМХ и КМП проявляют себя не в полную силу. Однако некоторые выводы можно сделать.

**Выводы:**
Все алгоритмы показывают линейную сложность O(N). Это ожидаемо для алгоритмов БМЪ и КМП, но для наивного алгоритма это неожиданно. Однако, я думаю что линейная сложность наивного алгоритма связана как раз с тем, что и текст и паттерн является случайным, из-за чего несовпадение текста с паттерном обнаруживается уже на втором или третьем сравнении.

Алгоритм БМХ очевидно выигрывает у наивной реализации алгоритма как по абсолютной скорости работы, так и по динамике роста.

Худшие результаты показал алгоритм КМП, что весьма неожиданно. Однако, я думаю что это связано с реализацией алгоритма. Проблема, на мой взгляд, в том, что таблица переключений - это массив массивов в динамической памяти, и в процессе работы алгоритм обращается к этой памяти более-менее случайным образом. Из-за чего происходят постоянные cache miss'ы (примерно по одному на каждый символ текста). В то же время, наивная реализация и алгоритм БМХ лишены этого недостатка и являются намного более "кэш-френдли", за счёт чего и выигрывают по скорости работы КМП.
